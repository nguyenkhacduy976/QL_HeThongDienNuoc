@{
    ViewData["Title"] = "Dashboard - Khách hàng";
}

<h2><i class="bi bi-person-circle"></i> Thông tin tài khoản</h2>

<div class="row g-3 mb-4 mt-3">
    <div class="col-md-4">
        <div class="stat-card">
            <h6 class="text-white-50">Hóa đơn chưa thanh toán</h6>
            <h3>@ViewBag.UnpaidBills</h3>
        </div>
    </div>
    <div class="col-md-4">
        <div class="stat-card" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
            <h6 class="text-white-50">Tổng công nợ</h6>
            <h3>@(((decimal)ViewBag.TotalDebt).ToString("N0")) đ</h3>
        </div>
    </div>
    <div class="col-md-4">
        <div class="stat-card" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
            <h6 class="text-white-50">Tình trạng</h6>
            <h3>@(ViewBag.UnpaidBills > 0 ? "Còn nợ" : "Đã thanh toán")</h3>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-header bg-transparent">
        <h5><i class="bi bi-receipt"></i> Hóa đơn gần đây</h5>
    </div>
    <div class="card-body">
        <table class="table">
            <thead>
                <tr>
                    <th>Số HĐ</th>
                    <th>Ngày phát hành</th>
                    <th>Hạn thanh toán</th>
                    <th>Số tiền</th>
                    <th>Đã thanh toán</th>
                    <th>Trạng thái</th>
                    <th>PDF</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var bill in (List<QL_HethongDiennuoc.Models.DTOs.BillDto>)ViewBag.MyBills)
                {
                    <tr>
                        <td><strong>@bill.BillNumber</strong></td>
                        <td>@bill.IssueDate.ToString("dd/MM/yyyy")</td>
                        <td>@bill.DueDate.ToString("dd/MM/yyyy")</td>
                        <td class="fw-bold">@bill.Amount.ToString("N0") đ</td>
                        <td>@bill.PaidAmount.ToString("N0") đ</td>
                        <td>
                            @if (bill.Status == "Paid")
                            {
                                <span class="badge bg-success">Đã thanh toán</span>
                            }
                            else if (bill.DueDate < DateTime.Now)
                            {
                                <span class="badge bg-danger">Quá hạn</span>
                            }
                            else
                            {
                                <span class="badge bg-warning">Chưa thanh toán</span>
                            }
                        </td>
                        <td>
                            <a href="/api/bills/@bill.Id/pdf" class="btn btn-sm btn-success" target="_blank">
                                <i class="bi bi-file-pdf"></i>
                            </a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>
